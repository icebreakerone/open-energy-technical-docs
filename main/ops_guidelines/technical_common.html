

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>6. Common Security Requirements &mdash; Open Energy Technical Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Open Energy Technical Documentation  documentation"
          href="../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Open Energy Architecture" href="../architecture.html" />
    <link rel="prev" title="5. Guidance for Data Providers" href="data_provider_ops_guidelines.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #0C3945" >
          


    <a href="../index.html" class="icon icon-home"> Open Energy Technical Documentation
        

        
        
        <img src="../_static/logo.png" class="logo" alt="Logo"/>
        
    </a>

    

    
    <div class="version">
        main
    </div>
    

    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

    
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction to Open Energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="before_starting.html">2. Considerations Before You Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="common_policies.html">3. Core Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_consumer_ops_guidelines.html">4. Guidance for Data Consumers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_provider_ops_guidelines.html">5. Guidance for Data Providers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Common Security Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#applicable-standards">6.1. Applicable standards</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#discovery-of-endpoint-urls">6.1.1. Discovery of endpoint URLs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#token-acquisition">6.2. Token acquisition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#token-usage-calling-a-shared-data-api">6.3. Token usage - calling a shared data API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#request-validation">6.4. Request validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#token-introspection">6.4.1. Token introspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introspection-response-validation">6.4.2. Introspection response validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#active">6.4.2.1. active</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-ranges">6.4.2.2. time ranges</a></li>
<li class="toctree-l4"><a class="reference internal" href="#certificate-thumbprint">6.4.2.3. certificate thumbprint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interaction-header">6.4.3. Interaction header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-validation">6.4.4. Other validation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">7. Open Energy Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata.html">8. Data Set Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../access_control_specification.html">9. Access Control and Capability Grant Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">10. Open Energy Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional_material.html">11. Additional Material</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Open Energy Technical Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">6. </span>Common Security Requirements</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            

<div class="admonition warning">
    <p class="admonition-title">Warning</p>
    <p>
        You're reading the development version of this documentation, at present there is no release version. Please
        bear in mind that this instance of the site is subject to change and should be considered provisional.
    </p>
</div>




  <div class="section" id="common-security-requirements">
<h1><span class="section-number">6. </span>Common Security Requirements<a class="headerlink" href="#common-security-requirements" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The key words <strong>“MUST”</strong>, <strong>“MUST NOT”</strong>, <strong>“REQUIRED”</strong>, <strong>“SHALL”</strong>, <strong>“SHALL NOT”</strong>, <strong>“SHOULD”</strong>,
<strong>“SHOULD NOT”</strong>, <strong>“RECOMMENDED”</strong>, <strong>“MAY”</strong>, and <strong>“OPTIONAL”</strong> in this document are to be interpreted
as described in <a class="reference external" href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#applicable-standards" id="id1">Applicable standards</a></p>
<ul>
<li><p><a class="reference internal" href="#discovery-of-endpoint-urls" id="id2">Discovery of endpoint URLs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#token-acquisition" id="id3">Token acquisition</a></p></li>
<li><p><a class="reference internal" href="#token-usage-calling-a-shared-data-api" id="id4">Token usage - calling a shared data API</a></p></li>
<li><p><a class="reference internal" href="#request-validation" id="id5">Request validation</a></p>
<ul>
<li><p><a class="reference internal" href="#token-introspection" id="id6">Token introspection</a></p></li>
<li><p><a class="reference internal" href="#introspection-response-validation" id="id7">Introspection response validation</a></p>
<ul>
<li><p><a class="reference internal" href="#active" id="id8">active</a></p></li>
<li><p><a class="reference internal" href="#time-ranges" id="id9">time ranges</a></p></li>
<li><p><a class="reference internal" href="#certificate-thumbprint" id="id10">certificate thumbprint</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#interaction-header" id="id11">Interaction header</a></p></li>
<li><p><a class="reference internal" href="#other-validation" id="id12">Other validation</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Open Energy defines a security and trust model for shared data <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">APIs</span></a>. Three
parties are involved in each shared data request:</p>
<ol class="arabic simple">
<li><p>The <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> wishing to access the <a class="reference internal" href="../glossary.html#term-Shared-data"><span class="xref std std-term">shared data</span></a> <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a></p></li>
<li><p>The <a class="reference internal" href="../glossary.html#term-Authorization"><span class="xref std std-term">authorization</span></a> server, as part of the governance service (<a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a>), with knowledge about the
<a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> as represented by an organisation account within the <a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a></p></li>
<li><p>The <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> responsible for supplying shared data through its shared data <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a></p></li>
</ol>
<p>The interactions are shown graphically below in the form of a sequence diagram.</p>
<div class="figure align-default" id="fapi-interactions-image">
<img alt="../_images/fapi_sequence_diagram.svg" src="../_images/fapi_sequence_diagram.svg" /><p class="caption"><span class="caption-number">Fig. 6.1 </span><span class="caption-text"><a class="reference internal" href="../glossary.html#term-Financial-Grade-API"><span class="xref std std-term">FAPI</span></a> Sequence Diagram - client credentials flow</span><a class="headerlink" href="#fapi-interactions-image" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="applicable-standards">
<h2><a class="toc-backref" href="#id1"><span class="section-number">6.1. </span>Applicable standards</a><a class="headerlink" href="#applicable-standards" title="Permalink to this headline">¶</a></h2>
<p>We use a strict sub-set of the <a class="reference internal" href="../glossary.html#term-Financial-Grade-API"><span class="xref std std-term">FAPI</span></a> specification for interactions between <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Providers</span></a> and <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumers</span></a>. The
applicable standards are linked here for reference, we reference the precise elements of these standards in later
sections.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc6749">RFC6749 The OAuth 2.0 Authorization Framework</a></p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc6750">RFC6750 The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></p></li>
<li><p><a class="reference external" href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a></p></li>
<li><p><a class="reference external" href="https://www.rfc-editor.org/rfc/rfc8705.html">RFC8705 OAuth 2.0 Mutual-TLS Client Authentication and Certificate-Bound Access Tokens</a></p></li>
</ul>
<div class="section" id="discovery-of-endpoint-urls">
<h3><a class="toc-backref" href="#id2"><span class="section-number">6.1.1. </span>Discovery of endpoint URLs</a><a class="headerlink" href="#discovery-of-endpoint-urls" title="Permalink to this headline">¶</a></h3>
<p>While not strictly necessary, the authorization server deployed as part of the <a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a> implements the OpenID Connect
Discovery provider configuration information endpoint as described
<a class="reference external" href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig">here</a>, references in this document to
e.g. <code class="docutils literal notranslate"><span class="pre">token_endpoint</span></code> refer to properties discoverable in this fashion.</p>
</div>
</div>
<div class="section" id="token-acquisition">
<h2><a class="toc-backref" href="#id3"><span class="section-number">6.2. </span>Token acquisition</a><a class="headerlink" href="#token-acquisition" title="Permalink to this headline">¶</a></h2>
<p>In order to access a shared data <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a>, a <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> must first acquire an access token. This is done by sending an
<a class="reference internal" href="../glossary.html#term-HypterText-Transfer-Protocol"><span class="xref std std-term">HTTP</span></a> request to the authorization server (part of the <a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a>). The <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> <strong>MUST</strong>:</p>
<ul>
<li><p>Use Mutual <a class="reference internal" href="../glossary.html#term-Transport-Layer-Security"><span class="xref std std-term">TLS</span></a>, presenting a client certificate when requested. This is the <code class="docutils literal notranslate"><span class="pre">tls_client_auth</span></code> authentication method
described in section 2 of <a class="reference internal" href="../glossary.html#term-OAuth-2.0-Mutual-TLS-Client-Authentication-and-Certificate-Bound-Access-Tokens"><span class="xref std std-term">RFC8705</span></a>.</p>
<blockquote>
<div><ul class="simple">
<li><p>In our implementation, this certificate is acquired by creating a <code class="docutils literal notranslate"><span class="pre">transport</span> <span class="pre">certificate</span></code> in a
<code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">statement</span></code> within the <a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a> directory</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">client_credentials</span></code> grant type</p></li>
<li><p>Send a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the <code class="docutils literal notranslate"><span class="pre">token_endpoint</span></code> of the authorization server containing the following properties
as <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> key / value pairs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client_id</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">CLIENT_ID</span><span class="o">&gt;</span>
<span class="n">scope</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">REQUESTED_SCOPES</span><span class="o">&gt;</span>
<span class="n">grant_type</span><span class="p">:</span> <span class="n">client_credentials</span>
</pre></div>
</div>
<p>Scope may be omitted, for most uses within Open Energy there is no requirement to specify a scope. <code class="docutils literal notranslate"><span class="pre">CLIENT_ID</span></code> can
be obtained from the <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">statement</span></code> within the directory corresponding to this client</p>
</li>
</ul>
<p>A successful call to the <code class="docutils literal notranslate"><span class="pre">token_endpoint</span></code> is indicated by a <code class="docutils literal notranslate"><span class="pre">200</span></code> response code, in which case the body of the
response will contain a <a class="reference internal" href="../glossary.html#term-Javascript-Object-Notation"><span class="xref std std-term">JSON</span></a> object with at least two properties:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">access_token</span></code> is an opaque string to be used as a bearer token for requests to resource servers
(a <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> <a class="reference internal" href="../glossary.html#term-Shared-data"><span class="xref std std-term">shared data</span></a> <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a> in our context)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expires_in</span></code> is an integer number of seconds from the current time, after which the token will no longer be valid
- after this point the <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> <strong>MUST</strong> request a new token in order to continue to access shared data resources</p></li>
</ol>
</div>
<div class="section" id="token-usage-calling-a-shared-data-api">
<h2><a class="toc-backref" href="#id4"><span class="section-number">6.3. </span>Token usage - calling a shared data API</a><a class="headerlink" href="#token-usage-calling-a-shared-data-api" title="Permalink to this headline">¶</a></h2>
<p>To call a shared data <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a> within a <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a>, the <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> MUST:</p>
<ul>
<li><p>Use Mutual <a class="reference internal" href="../glossary.html#term-Transport-Layer-Security"><span class="xref std std-term">TLS</span></a> as previously described</p></li>
<li><p>Pass the previously acquired bearer token in an <a class="reference internal" href="../glossary.html#term-HypterText-Transfer-Protocol"><span class="xref std std-term">HTTP</span></a> header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Authorization</span><span class="p">:</span> <span class="n">Bearer</span> <span class="o">&lt;</span><span class="n">TOKEN</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p>In addition, the <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> <strong>SHOULD</strong>:</p>
<ul>
<li><p>Specify an interaction <a class="reference internal" href="../glossary.html#term-Identification"><span class="xref std std-term">ID</span></a> for this call in an <a class="reference internal" href="../glossary.html#term-HypterText-Transfer-Protocol"><span class="xref std std-term">HTTP</span></a> header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">-</span><span class="n">fapi</span><span class="o">-</span><span class="n">interaction</span><span class="o">-</span><span class="nb">id</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">UUID</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This allows for tracking of transactions between clients and resource servers, aiding troubleshooting. We use a <a class="reference internal" href="../glossary.html#term-Universally-unique-identififer-v4"><span class="xref std std-term">UUID4</span></a>
in our reference implementation</p>
</li>
</ul>
</div>
<div class="section" id="request-validation">
<h2><a class="toc-backref" href="#id5"><span class="section-number">6.4. </span>Request validation</a><a class="headerlink" href="#request-validation" title="Permalink to this headline">¶</a></h2>
<p>To participate in the Open Energy ecosystem, a <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong>:</p>
<ul class="simple">
<li><p>Expose an <a class="reference internal" href="../glossary.html#term-Secure-HTTP"><span class="xref std std-term">HTTPS</span></a> <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a></p></li>
<li><p>Perform validation on any requests to this <a class="reference internal" href="../glossary.html#term-Application-programming-interface"><span class="xref std std-term">API</span></a></p>
<ul>
<li><p>Reject any requests which do not present a valid client certificate. Client certificates are validated in the
context of the root CAs provided by the <a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a> directory.</p></li>
<li><p>Reject any requests which do not provide an <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header containing a <code class="docutils literal notranslate"><span class="pre">Bearer</span></code> token as described
above</p></li>
</ul>
</li>
</ul>
<p>If any of the above checks fail, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST NOT</strong> continue processing the request, and <strong>SHOULD</strong> respond with
an error response as defined in <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc6750#section-6.2">this section</a> of <a class="reference internal" href="../glossary.html#term-The-OAuth-2.0-Authorization-Framework-Bearer-Token-Usage"><span class="xref std std-term">RFC6750</span></a></p>
<div class="section" id="token-introspection">
<h3><a class="toc-backref" href="#id6"><span class="section-number">6.4.1. </span>Token introspection</a><a class="headerlink" href="#token-introspection" title="Permalink to this headline">¶</a></h3>
<p>If all the above checks pass, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong> then validate the presented token. Tokens in our case are opaque
identifiers (as opposed to JWTs) and must be passed to the <code class="docutils literal notranslate"><span class="pre">introspection_endpoint</span></code> of the authorization server to
obtain additional information. To obtain this introspection response, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong>:</p>
<ul>
<li><p>Make a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the <code class="docutils literal notranslate"><span class="pre">introspection_endpoint</span></code> of the authorization server</p></li>
<li><p>Use Mutual <a class="reference internal" href="../glossary.html#term-Transport-Layer-Security"><span class="xref std std-term">TLS</span></a>, this means <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Providers</span></a> must also have a provisioned client within the <a class="reference internal" href="../glossary.html#term-Open-Energy-Governance-Service"><span class="xref std std-term">OEGS</span></a> directory in the form
of a <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">statement</span></code> and corresponding transport certificate</p></li>
<li><p>Send the bearer token and client <a class="reference internal" href="../glossary.html#term-Identification"><span class="xref std std-term">ID</span></a> of the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> as an <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> body with the
following values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">token</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BEARER_TOKEN</span><span class="o">&gt;</span>
<span class="n">client_id</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CLIENT_ID</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="introspection-response-validation">
<h3><a class="toc-backref" href="#id7"><span class="section-number">6.4.2. </span>Introspection response validation</a><a class="headerlink" href="#introspection-response-validation" title="Permalink to this headline">¶</a></h3>
<p>The response body of this introspection call contains a <a class="reference internal" href="../glossary.html#term-Javascript-Object-Notation"><span class="xref std std-term">JSON</span></a> object with information about the entity which requested
the supplied token from the authorization server, as well as properties of the token itself. An example introspection
response is shown below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;active&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;organisation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
  <span class="nt">&quot;organisation_name&quot;</span><span class="p">:</span> <span class="s2">&quot;A Demo Provider&quot;</span><span class="p">,</span>
  <span class="nt">&quot;organisation_number&quot;</span><span class="p">:</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
  <span class="nt">&quot;software_roles&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;EDSP_L1&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;software_description&quot;</span><span class="p">:</span> <span class="s2">&quot;Description: https://www.demo.org.uk/ is the location of our demo server&quot;</span><span class="p">,</span>
  <span class="nt">&quot;additional_software_metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;something&quot;</span><span class="p">:</span> <span class="s2">&quot;something else&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;kZuAsn7UyZ98Wwh29hDpf&quot;</span><span class="p">,</span>
  <span class="nt">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1626279245</span><span class="p">,</span>
  <span class="nt">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1626278645</span><span class="p">,</span>
  <span class="nt">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;https://auth.directory.energydata.org.uk&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;directory:software&quot;</span><span class="p">,</span>
  <span class="nt">&quot;cnf&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;x5t#S256&quot;</span><span class="p">:</span> <span class="s2">&quot;rP_-9u3ZyVo4ryQxg-bn4rr6gJGNu1dTowEeppOuIt8&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following elements of the introspection response <strong>MUST</strong> be validated further before any Open Energy specific
processing is performed:</p>
<div class="section" id="active">
<h4><a class="toc-backref" href="#id8"><span class="section-number">6.4.2.1. </span>active</a><a class="headerlink" href="#active" title="Permalink to this headline">¶</a></h4>
<p>If the introspection response does not contain the key <code class="docutils literal notranslate"><span class="pre">active</span></code>, or the value of this key is anything other than the
boolean <code class="docutils literal notranslate"><span class="pre">true</span></code> value, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong> reject the request and cease further processing.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">active</span></code> key was not present, it <strong>SHOULD</strong> respond with <code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">invalid_request</span></code></p>
<p>If the <code class="docutils literal notranslate"><span class="pre">active</span></code> key was present but not <code class="docutils literal notranslate"><span class="pre">true</span></code> it <strong>SHOULD</strong> respond with <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">invalid_token</span></code></p>
</div>
<div class="section" id="time-ranges">
<h4><a class="toc-backref" href="#id9"><span class="section-number">6.4.2.2. </span>time ranges</a><a class="headerlink" href="#time-ranges" title="Permalink to this headline">¶</a></h4>
<p>If the introspection response contains <code class="docutils literal notranslate"><span class="pre">iat</span></code> this is interpreted as a number of seconds since the epoch at which the
token was issued. If this is in the future the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong> reject the request and cease further processing. It
SHOULD respond with a <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">invalid_token</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>SHOULD</strong> allow for a reasonable degree of clock skew when interpreting the <code class="docutils literal notranslate"><span class="pre">iat</span></code> timestamp, an
allowance of no more than 10 seconds should cover all reasonable cases.</p>
</div>
<p>If the introspection response contains <code class="docutils literal notranslate"><span class="pre">exp</span></code> this is interpreted as a number of seconds since the epoch after which
the token should be considered invalid. If this is in the past, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong> reject the request and cease
further processing. It <strong>SHOULD</strong> respond with a <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">invalid_token</span></code></p>
</div>
<div class="section" id="certificate-thumbprint">
<h4><a class="toc-backref" href="#id10"><span class="section-number">6.4.2.3. </span>certificate thumbprint</a><a class="headerlink" href="#certificate-thumbprint" title="Permalink to this headline">¶</a></h4>
<p>Open Energy uses certificate pinning combined with MTLS on all requests between <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumers</span></a> and <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Providers</span></a>. This
ensures that a token issued to one client cannot be re-used by another client. <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Providers</span></a> <strong>MUST</strong> check that the
thumbprint of the presented client certificate matches that provided within the introspection response.</p>
<p>The introspection response contains the SHA256 thumbprint of the certificate used to acquire the token as a nested
property <code class="docutils literal notranslate"><span class="pre">['cnf']['x5t#S256']</span></code>. This <strong>MUST</strong> be equal to the SHA256 thumbprint of the client certificate, if this is
not the case the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MUST</strong> reject the request and cease any further processing, responding with a
<code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">invalid_token</span></code></p>
</div>
</div>
<div class="section" id="interaction-header">
<h3><a class="toc-backref" href="#id11"><span class="section-number">6.4.3. </span>Interaction header</a><a class="headerlink" href="#interaction-header" title="Permalink to this headline">¶</a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">x-fapi-interaction-id</span></code> header is set in the request, it <strong>MUST</strong> be set to the same value in the response
header of the same name. If not set, a new ID <strong>MUST</strong> be generated and set in the response header.</p>
</div>
<div class="section" id="other-validation">
<h3><a class="toc-backref" href="#id12"><span class="section-number">6.4.4. </span>Other validation</a><a class="headerlink" href="#other-validation" title="Permalink to this headline">¶</a></h3>
<p>If all the above checks have passed, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> can service the request and return whatever data were requested.
It <strong>MAY</strong>, however, apply additional checks based on information in the introspection response about the client. This
is where any Open Energy specific access control and licensing policies are applied.</p>
<p>To inform any additional processing, the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a> <strong>MAY</strong> make use of the
<code class="docutils literal notranslate"><span class="pre">['additional_client_metadata']['metadata']</span></code> key within the introspection response. This contains a <a class="reference internal" href="../glossary.html#term-Javascript-Object-Notation"><span class="xref std std-term">JSON</span></a> object with
properties asserted about the <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a>. The exact set of properties is not defined here, please see the access
control language specification for more information about what could be specified.</p>
<p><a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Providers</span></a> <strong>MAY</strong> make use of the <code class="docutils literal notranslate"><span class="pre">organisation_id</span></code> field in the token introspection response to uniquely and consistently
identify the organisation of the <a class="reference internal" href="../glossary.html#term-Data-Consumer"><span class="xref std std-term">Data Consumer</span></a> where required, for example to reference a customer record within the <a class="reference internal" href="../glossary.html#term-Data-Provider"><span class="xref std std-term">Data Provider</span></a>.</p>
<p>More information on the Open Energy specific access control language can be found in
<a class="reference internal" href="../access_control_specification.html#access-control-and-capability-grant-language"><span class="std std-ref">Access Control and Capability Grant Language</span></a>, and its expression in the metadata file at <a class="reference internal" href="../metadata.html#data-set-metadata"><span class="std std-ref">Data Set Metadata</span></a> in the
<a class="reference internal" href="../metadata.html#access-block"><span class="std std-ref">Access Block</span></a> section.</p>
</div>
</div>
</div>



           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../architecture.html" class="btn btn-neutral float-right" title="7. Open Energy Architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="data_provider_ops_guidelines.html" class="btn btn-neutral float-left" title="5. Guidance for Data Providers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
<p>
    &#169; Copyright <a href="https://opencorporates.com/companies/gb/12156788">Icebreaker One Limited</a>.
    <span class="lastupdated">
        Last updated on Jul 26, 2021.
      </span>

</p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>


</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="technical_common.html">main</a></dd>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>